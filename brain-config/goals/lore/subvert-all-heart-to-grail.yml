name: "Subvert all lore: Heart to Grail"
completedWhen:
  noneOf:
    - aspects:
        lore: 1
        # There are times when things have the Lore aspect but aren't traditional lore.
        subvertable_lore: 1
        heart:
          greaterThanOrEqualTo: 2
impulses:
  - name: Ensure we have glimmering
    priority: maintenance
    forbidders:
      anyOf:
        - aspects: { sanctuary: 1 }
        - elementId: glimmering
          lifetimeRemaining:
            greaterThan: 60
    operation: !import ../../../operations/passion/study-passion.yml

  - name: Subvert Heart to Grail
    operation: !import ../../operations/lore/grail/lore-subvert-heart-grail-c.yml

  - name: Downgrade Heart C
    operation: !import ../../operations/lore/heart/lore-breakdown-heart-c.yml

  - name: Downgrade Grail C
    requirements:
      anyOf:
        - elementId: fragmentheart
        - elementId: fragmentheartb
    forbidders:
      elementId: fragmentgrailb
    operation: !import ../../operations/lore/grail/lore-breakdown-grail-c.yml

  - name: Subvert Heart to Grail
    operation: !import ../../operations/lore/grail/lore-subvert-heart-grail-b.yml

  - name: Downgrade Heart B
    operation: !import ../../operations/lore/heart/lore-breakdown-heart-b.yml

  - name: Downgrade Grail B
    requirements:
      elementId: fragmentheart
    forbidders:
      elementId: fragmentgrail
    operation: !import ../../operations/lore/grail/lore-breakdown-grail-b.yml
    
  - name: Subvert Heart to Grail
    operation: !import ../../operations/lore/grail/lore-subvert-heart-grail-a.yml
