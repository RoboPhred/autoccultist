goals:
  - !import goals/aspirant/begin-intro.yml
  - !import goals/aspirant/study-bequest-passion.yml
  - name: Find a Collaborator
    requirements:
      elementId: contactintro
    completedWhen:
      allOf:
        - aspects:
            acquaintance: 1
    imperativeSets:
      - !import imperative-sets/survive.yml
    imperatives:
      - !import imperatives/maint-work-health.yml
      - !import imperatives/maint-refresh-health.yml
      - name: Contact Collaborator
        priority: goal
        operation:
          situation: study
          startingRecipe:
            slots:
              study:
                elementId: contactintro
  - name: Wait for health refresh
    requirements:
      # TODO: This is too vague, it might kick in instead of Survive if we have a fatigue around
      #  That is typically ok, but we might want to be able to retire goals after they are completed
      #  Or have them stick to an ordered list, skipping the ones that dont apply at the time.
      anyOf:
        - elementId: fatigue
        - elementId: hunger
        - elementId: injury
        - elementId: affliction
    completedWhen:
      anyOf:
        - elementId: health
        - aspects:
            healthskill: 1
    imperativeSets:
      - !import imperative-sets/survive.yml
    imperatives:
      - !import imperatives/maint-refresh-health.yml
  - name: Get Health skill A
    requirements:
      cardSet:
        - elementId: health
    completedWhen:
      anyOf:
        - elementId: skillhealtha
        - elementId: skillhealthb
        - elementId: skillhealthc
        - elementId: skillhealthd_grace
        - elementId: skillhealthd_strength
    imperativeSets:
      - !import imperative-sets/survive.yml
    imperatives:
      - !import imperatives/maint-work-health.yml
      - !import imperatives/maint-refresh-health.yml
      - !import imperatives/goal-learn-lesson-vitality.yml
  - name: Get Health skill B
    requirements:
      elementId: skillhealtha
    completedWhen:
      anyOf:
        - elementId: skillhealthb
        - elementId: skillhealthc
        - elementId: skillhealthd_grace
        - elementId: skillhealthd_strength
    imperativeSets:
      - !import imperative-sets/survive.yml
    imperatives:
      - !import imperatives/maint-refresh-health.yml
      - name: Stronger Physique work
        priority: maintenance
        operation: !import operations/work-skillhealth.yml
        forbidders:
          anyOf:
            - # Don't steal away our health skill card when we need it to upgrade.
              cardSet:
                - elementId: vitalityplus
                - elementId: vitalityplus
            - !import conditions/illhealth-unsatisfied.yml
            - !import conditions/illhealth-pending-15secs.yml
      - !import imperatives/norm-vitality-from-health.yml
      - extends: !import imperatives/goal-learn-lesson-vitality.yml
        forbidders:
          # Do not monopolize study when we have vitality lessons to study
          cardSet:
            - elementId: vitalityplus
            - elementId: vitalityplus
      - name: Upgrade Stronger Physique to Hardened Physique
        priority: goal
        operation: !import operations/upgrade-skillhealtha.yml
  - name: Get Health skill C
    requirements:
      cardSet:
        - elementId: skillhealthb
    completedWhen:
      anyOf:
        - elementId: skillhealthc
        - elementId: skillhealthd_grace
        - elementId: skillhealthd_strength
    imperativeSets:
      - !import imperative-sets/survive.yml
    imperatives:
      - !import imperatives/maint-refresh-health.yml
      - name: Hardened Physique work
        priority: maintenance
        operation: !import operations/work-skillhealth.yml
        forbidders:
          anyOf:
            - # Stop gaining lessons when we have enough
              cardSet:
                - elementId: vitalityplus
                - elementId: vitalityplus
                - elementId: vitalityplus
            - !import conditions/illhealth-unsatisfied.yml
            - !import conditions/illhealth-pending-15secs.yml
      - extends: !import imperatives/goal-learn-lesson-vitality.yml
        forbidders:
          # Stop using our skill card when we have enough lessons
          cardSet:
            - elementId: vitalityplus
            - elementId: vitalityplus
            - elementId: vitalityplus
      - !import imperatives/norm-vitality-from-health.yml
      - name: Upgrade Hardened Physique to Steely Physique
        priority: goal
        operation: !import operations/upgrade-skillhealthb.yml
  - name: Read Morland books
    requirements:
      allOf:
        - elementId: skillhealthc # TODO: We only check skillhealthc to make this run after "Get Health skill C".  Remove this when goals are linear
        - elementId: locationbookdealer
        - !import conditions/can-procure-funds.yml
    completedWhen:
      allOf:
        - elementId: locationbookdealer_exhausted
        - noneOf:
            - aspects: { text: 1 }
    imperativeSets:
      - !import imperative-sets/survive.yml
      - !import imperative-sets/procure-funds.yml
    imperatives:
      - name: Physical work
        priority: maintenance
        operation: !import operations/work-skillhealth.yml
      - !import imperatives/maint-refresh-health.yml
      - !import imperatives/maint-upgrade-excess-vitality.yml
      - !import imperatives/maint-buy-books.yml
      - !import imperatives/maint-translate-books-greek.yml
      - !import imperatives/maint-read-books.yml
  - name: Survive
    requirements:
      elementId: locationbookdealer_exhausted # TODO: We only require exhausted book dealer because goals are not yet linear.  Make goals linear and remove this.
    imperativeSets:
      - !import imperative-sets/survive.yml
